CREATE DATABASE LIBRARY;
USE LIBRARY;
CREATE TABLE BRANCH(BRANCH_NO INT PRIMARY KEY,MANAGER_ID INT,BRANCH_ADDRESS VARCHAR(30),CONTACT_NO VARCHAR(30));
CREATE TABLE EMPLOYEE(EMP_ID INT PRIMARY KEY,EMP_NAME VARCHAR(30),POSITION VARCHAR(30),SALARY INT);
CREATE TABLE CUSTOMER(CUSTOMER_ID INT PRIMARY KEY,CUSTOMER_NAME VARCHAR(30),CUSTOMER_ADDRESS VARCHAR(30),REG_DATE timestamp DEFAULT current_timestamp());
CREATE TABLE BOOKS(ISBN INT PRIMARY KEY,BOOK_TITLE VARCHAR(30),CATEGORY VARCHAR(30),
RENTAL_PRICE INT,STATUS VARCHAR(30),AUTHOR VARCHAR(30),PUBLISHER VARCHAR(30));
CREATE TABLE ISSUESTATUS(ISSUE_ID INT PRIMARY KEY, ISSUED_CUST INT,ISSUED_BOOK_NAME VARCHAR(30),
ISSUED_DATE DATE,ISBN_BOOK INT,FOREIGN KEY(ISSUED_CUST) REFERENCES CUSTOMER(CUSTOMER_ID),
FOREIGN KEY(ISBN_BOOK) REFERENCES BOOKS(ISBN));
CREATE TABLE RETURNSTATUS(RETURN_ID INT PRIMARY KEY,RETURN_CUST INT,RETURN_BOOK_NAME VARCHAR(30),RETURN_DATE DATE,ISBN_BOOK2 INT,
FOREIGN KEY(ISBN_BOOK2) REFERENCES BOOKS(ISBN),FOREIGN KEY(RETURN_CUST) REFERENCES CUSTOMER(CUSTOMER_ID));

DROP TABLE RETURNSTATUS;

INSERT INTO BRANCH VALUES(1,101,"GRANDHA PANAMPILLYNAGAR","04842232110");
INSERT INTO EMPLOYEE VALUES(101,'ALKA PANDYA','LIBRARIAN',200000);

SELECT * FROM BRANCH;
SELECT * FROM EMPLOYEE;

INSERT INTO CUSTOMER VALUES (1,'RAHUL','KADVANTHRA NEAR METROHUB','2020-03-11');
INSERT INTO CUSTOMER VALUES(2,'AKHIL','THOPPUMPADY','2021-03-11');
INSERT INTO CUSTOMER VALUES(3,'RAGESH','PERUMPADDPU','2021-04-11');
INSERT INTO CUSTOMER VALUES(4,'RAJESH','ELAMKULAM','2021-02-11');
INSERT INTO CUSTOMER VALUES(5,'NIKHIL','KALOOR','2007-06-11');

SELECT * FROM CUSTOMER;

INSERT INTO BOOKS VALUES(1,'WINGS OF FIRE','AUTOBIOGRAPHY',200,'YES',' Dr. A.P.J. Abdul Kalam','Universities Press');
INSERT INTO BOOKS VALUES(2,"To Kill a Mockingbird",'NOVEL',500,'YES','HARPER LEE','J.B.LIPPINCOTT &CO.');
INSERT INTO BOOKS VALUES(3,'1984','NOVEL',1000,'YES','GEORGE ORWELL','SECKER & WARBURG');
INSERT INTO BOOKS VALUES(4,'PRIDE AND PREJUDICE','FICTION',300,'YES','JANE AUSTEN','T.EGERTON, WHITEHALL');
INSERT INTO BOOKS VALUES (5,'THE GREAT GATSBY','NOVEL',100,'YES','F.SCOTT FITZGERALD','CHARLES SCRIBNERS SONS');


SELECT * FROM BOOKS;
INSERT INTO ISSUESTATUS VALUES(1,1,'WINGS OF FIRE','2020-03-10',1);
INSERT INTO ISSUESTATUS VALUES(2,3,'To Kill a Mockingbird','2020-03-11',2);
INSERT INTO ISSUESTATUS VALUES(3,4,'1984','2020-04-10',3);


INSERT INTO RETURNSTATUS VALUES(1,5,'THE GREAT GATSBY','2020-03-10',5);
INSERT INTO RETURNSTATUS VALUES(2,4,'PRIDE AND PREJUDICE','2020-02-10',4);
INSERT INTO RETURNSTATUS VALUES(3,3,'1984','2020-01-10',2);


SELECT * FROM RETURNSTATUS;
-- 1
SELECT BOOK_TITLE,CATEGORY,RENTAL_PRICE FROM BOOKS;
-- 2
SELECT *FROM EMPLOYEE ORDER BY EMP_NAME DESC;
-- 3
SELECT ISSUESTATUS.ISBN_BOOK,ISSUESTATUS.ISSUED_CUST,BOOKS.BOOK_TITLE,CUSTOMER.CUSTOMER_NAME FROM ISSUESTATUS 
JOIN BOOKS ON ISSUESTATUS.ISBN_BOOK=BOOKS.ISBN
JOIN CUSTOMER ON ISSUESTATUS.ISSUED_CUST=CUSTOMER.CUSTOMER_ID;
-- 4
SELECT CATEGORY, COUNT(*) AS TOTAL_COUNT FROM BOOKS GROUP BY CATEGORY ;
-- 5.
SELECT EMP_NAME,POSITION FROM EMPLOYEE WHERE SALARY>=50000;
-- 6
SELECT CUSTOMER_NAME FROM CUSTOMER WHERE REG_DATE < '2022-01-01' AND CUSTOMER_ID NOT IN ( SELECT ISSUED_CUST FROM ISSUESTATUS);
-- 7
SELECT B.BRANCH_NO, COUNT(E.EMP_ID) AS TOTAL_EMPLOYEES
FROM BRANCH B
LEFT JOIN EMPLOYEE E ON B.MANAGER_ID = E.EMP_ID
GROUP BY B.BRANCH_NO;
-- 8.
SELECT DISTINCT CUSTOMER.CUSTOMER_NAME
FROM CUSTOMER
JOIN ISSUESTATUS ON CUSTOMER.CUSTOMER_NAME = ISSUESTATUS.ISSUED_CUST
WHERE ISSUESTATUS.ISSUED_DATE >= '2023-06-01' AND ISSUESTATUS.ISSUED_DATE < '2023-07-01';
-- 9.
SELECT * FROM BOOKS WHERE CATEGORY='HISTORY';
-- 10.
SELECT B.BRANCH_NO, COUNT(E.EMP_ID) AS TOTAL_EMPLOYEES
FROM BRANCH B
LEFT JOIN EMPLOYEE E ON B.MANAGER_ID = E.EMP_ID
GROUP BY B.BRANCH_NO
HAVING COUNT(E.EMP_ID) > 5;
